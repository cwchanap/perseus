#:schema node_modules/wrangler/config-schema.json
name = "workflows"
main = "src/index.ts"
compatibility_date = "2024-12-30"
compatibility_flags = ["nodejs_compat"]

# Workflow definition
[[workflows]]
name = "perseus"
binding = "PUZZLE_WORKFLOW"
class_name = "PerseusWorkflow"

# R2 bucket for puzzle assets
# NOTE: For production deployment, use wrangler.production.toml or override via CLI.
[[r2_buckets]]
binding = "PUZZLES_BUCKET"
bucket_name = "perseus-local"

# KV namespace for puzzle metadata
# NOTE: Use environment-specific configs for deployment:
#   wrangler deploy --config wrangler.dev.toml
#   wrangler deploy --config wrangler.production.toml
# Local development uses preview_id for wrangler dev sessions
[[kv_namespaces]]
binding = "PUZZLE_METADATA"
id = "local-workflows-kv"
preview_id = "local-workflows-kv-preview"

[durable_objects]
bindings = [
	{ name = "PUZZLE_METADATA_DO", class_name = "PuzzleMetadataDO" }
]

[[migrations]]
tag = "v1"
new_classes = ["PuzzleMetadataDO"]
